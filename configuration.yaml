homeassistant:
  name: !secret address
  unit_system: metric
  latitude: !secret home_latitude
  longitude: !secret home_longitude
  elevation: 102
  time_zone: Australia/Adelaide
  customize: !include_dir_merge_named configuration/customize/
  whitelist_external_dirs:
  - '/tmp'
  packages: !include_dir_named packages

zone:
  name: Home
  latitude: !secret home_latitude
  longitude: !secret home_longitude
  radius: 50

logger:
  default: warn
  logs:
    homeassistant.components.switch.command_line: fatal
    

######################################################################################################
###------------------------------------------ YAML FILES ------------------------------------------###
######################################################################################################
automation: !include_dir_merge_list configuration/automation/
group: !include_dir_merge_named configuration/group/
script: !include configuration/scripts.yaml

######################################################################################################
###------------------------------------------ COMPONENTS ------------------------------------------###
######################################################################################################
frontend:
  javascript_version: latest
  themes: !include configuration/themes.yaml
  extra_html_url:
    - /local/custom_ui/state-card-tiles.html
    - /local/custom_ui/custom-weather-card.html
  extra_html_url_es5:
    - /local/custom_ui/state-card-tiles_es5.html
    - /local/custom_ui/custom-weather-card.html


updater:
  include_used_components: true

discovery:
  ignore:
  - yeelight

conversation:

history:

logbook:
  exclude:
    entities:
    - light_controller.last_message
    - automation.battery_sensor_from_battery_level_attribute
    - automation.battery_sensor_from_battery_attribute
    - automation.battery_notification_clear
    - automation.battery_notification
    - automation.update_battery_status_group_members
    - automation.lights_set_lifx_brightness
    - automation.lights_set_lifx_colour_temp
    - sensor.time
    - sensor.time_2
    - sensor.time__date
    - sensor.time_utc
    domains:
    - group

sun:

config:

map:
recorder:
  purge_interval: 2
  purge_keep_days: 14

shopping_list:

influxdb:
  host: 10.1.0.7

light:
  - platform: lifx

  - platform: mqtt
    name: Carport
    command_topic: cmnd/sonoff/carport-lights/POWER
    payload_on: 'ON'
    payload_off: 'OFF'
    state_topic: stat/sonoff/carport-lights/POWER

  - platform: mqtt
    name: Flux
    command_topic: "light/flux/command"
    color_temp_command_topic: "light/flux/color_temp"
    rgb_command_topic: "light/flux/color_rgb"

  - platform: xiaomi_miio
    name: Down Light
    host: 10.10.1.143
    token: !secret xiaomi_miio_token_light
    model: philips.light.bulb

  - platform: yeelight
    devices:
      10.10.2.141:
        name: Front West
      10.10.2.142:
        name: Front East

  - platform: group
    name: Outside Front
    entities:
      - light.front_west
      - light.front_east

  - platform: group
    name: Pool Room
    entities:
      - light.pool_room_north
      - light.pool_room_south

  - platform: mqtt
    name: Verandah
    command_topic: "node/003/command"
    state_topic: "node/003/state"
    payload_on: "light_on"
    payload_off: "light_off"

light_controller:
  topic: node/light_switch/
  
climate:
  - platform: daikin
    name: ac_bedroom
    host: 10.10.3.163

fan:
  - platform: xiaomi_miio
    host: 10.10.2.164
    token: !secret xiaomi_miio_token_airpurifier

  - platform: mqtt
    name: "Verandah"
    command_topic: "node/003/command"
    state_topic: "node/003/state"
    speed_command_topic: "node/003/command"
    payload_on: "fan_on"
    payload_off: "fan_off"
    payload_low_speed: "fan_low"
    payload_medium_speed: "fan_medium"
    payload_high_speed: "fan_high"
    speeds:
      - low
      - medium
      - high

#emulated_hue:
#    listen_port: 8300

alexa:
  smart_home:
    filter:
      include_entities:
      - light.bedroom
      - light.wardrobe
      - light.ensuite
      - light.study
      - light.kitchen
      - light.living_room
      - light.lounge
      - light.front_door
      - light.laundry
      - light.back_door
      - light.carport
      - light.outside_front
      - light.verandah
      - switch.heater_living_room_power
      - switch.triplej
      - input_boolean.sprinkler_control
      - switch.heater_living_room_power
      - switch.vacuum
      - switch.airplay_shed
      - switch.airplay_appletv
      - switch.airplay_bedroom
      - group.lights
    entity_config:
      switch.heater_living_room_power:
        name: Living Room Heater
        description: The heater in the living room
        display_categories: SMARTPLUG
      switch.triplej:
        name: Triple J
        description: Triple J on the radio
        display_categories: SPEAKER
      switch.vacuum:
        name: Vacuum Cleaner
        display_categories: SMARTPLUG
      input_boolean.sprinkler_control:
        name: Sprinklers
        display_categories: SWITCH
      switch.airplay_shed:
        name: Shed AirPlay
        display_categories: SPEAKER
      switch.airplay_appletv:
        name: Living Room AirPlay
        display_categories: SPEAKER
      switch.airplay_bedroom:
        name: Bedroom AirPlay
        display_categories: SPEAKER
      group.lights:
        name: All Lights
        display_categories: LIGHT


media_player:
  - platform: plex
  
  - platform: universal
    name: Living Room
    children:
      - media_player.living_room_apple_tv
    commands:
      turn_on:
        service: script.living_room_tv_on
      turn_off:
        service: script.living_room_tv_off
      volume_up:
        service: switch.turn_on
        data:
          entity_id: switch.living_room_audio_volume
      volume_down:
        service: switch.turn_off
        data:
          entity_id: switch.living_room_audio_volume
      volume_mute:
        service: switch.turn_on
        data:
          entity_id: switch.living_room_audio_mute
    attributes:
      # is_volume_muted: ENTITY_ID|ATTRIBUTE
      state: binary_sensor.living_room_tv_power_status

  - platform: universal
    name: Bedroom
    children:
    - media_player.bedroom_chromecast
    commands:
      turn_on:
        service: media_player.turn_on
        data:
          entity_id: media_player.bedroom_chromecast
      turn_off:
        service: media_player.turn_off
        data:
          entity_id: media_player.bedroom_chromecast
      volume_up:
        service: media_player.volume_up
        data:
          entity_id: media_player.bedroom_chromecast
      volume_down:
        service: media_player.volume_down
        data:
          entity_id: media_player.bedroom_chromecast

media_extractor:

cast:
  media_player:
  - host: 10.10.3.123

ifttt:
  key: !secret ifttt_key

ffmpeg:
  ffmpeg_bin: /usr/bin/ffmpeg

camera:
  - platform: ffmpeg
    input: -rtsp_transport tcp -i rtsp://10.10.2.149/unicast
    name: Carport
    extra_arguments: -pred 1 -q:v 2

  - platform: ffmpeg
    input: -rtsp_transport tcp -i rtsp://10.10.3.148:8554/unicast
    name: Front Yard
    extra_arguments: -pred 1 -q:v 2
    
http:
  api_password: !secret api_password
  trusted_networks:
  ip_ban_enabled: true
  login_attempts_threshold: 3
  use_x_forwarded_for: true
  trusted_proxies:
  - 127.0.0.1
  base_url: !secret dns_name
#  ssl_certificate: !secret ssl_cert
#  ssl_key: !secret ssl_key

google_assistant:
  project_id: home-assistant-144414
  client_id: !secret google_client_id
  access_token: !secret google_access_token
  api_key: !secret google_homegraph_api_key
  exposed_domains:
    - switch
    - light
    - group

notify:
#  - platform: telstra
#    name: Telstra_SMS
#    consumer_key: !secret telstra_key
#    consumer_secret: !secret telstra_secret
#    phone_number: !secret mobile_number

  - platform: html5
    name: html5
    gcm_api_key: !secret gcm_api_key
    gcm_sender_id: !secret gcm_sender_id

device_tracker:
#  - platform: icloud
#    username: !secret icloud_username
#    password: !secret icloud_password
#    track_new_devices: no

#  - platform: bluetooth_tracker

#  - platform: asuswrt
#    host: 192.168.1.1
#    username: !secret asus_router_username
#    password: !secret asus_router_password
#    new_device_defaults:
#      track_new_devices: False
#      hide_if_away: False
#    interval_seconds: 5

  - platform: unifi
    host: 10.1.0.154
    username: !secret unifi_username
    password: !secret unifi_password
    detection_time: 5
    verify_ssl: False
    new_device_defaults:
      track_new_devices: False
      hide_if_away: False

mqtt:
  broker: 127.0.0.1
  port: 1883
  username: !secret mqtt_username
  password: !secret mqtt_password
  discovery: true
  discovery_prefix: homeassistant

panel_iframe:
  router:
    title: Router
    url: http://10.0.0.1/
    icon: mdi:access-point-network
  unifi:
    title: UniFi
    url: !secret dns_unifi
    icon: mdi:router-wireless
  sonarr:
    title: Sonarr
    url: !secret dns_sonarr
    icon: mdi:television-classic
  radarr:
    title: Radarr
    url: !secret dns_radarr
    icon: mdi:filmstrip
  plex:
    title: Plex
    url: !secret dns_plex
    icon: mdi:plex

vacuum:
  - platform: xiaomi_miio
    host: 10.10.3.140
    token: !secret xiaomi_miio_token_vacuum

xiaomi_aqara:
  discovery_retry: 5
  gateways:
    - mac: !secret xiaomi_aqara_mac
      key: !secret xiaomi_aqara_key
      host: 10.10.3.10

apple_tv:
  - host: 10.2.0.17
    login_id: !secret apple_tv_id
    credentials: !secret apple_tv_credentials

weather:
  - platform: yweather

# DON'T ENABLE. TOO MANY API CALLS
#  - platform: darksky
#    api_key: !secret darksky_api_key

  - platform: bom
    station: 'IDS60901.95677'


######################################################################################################
###-------------------------------------------- HOMEKIT  ------------------------------------------###
######################################################################################################

homekit:
  auto_start: false
  ip_address: 10.1.0.3
  filter:
    include_entities:
    - light.bedroom
    - light.ensuite
    - light.study
    - light.kitchen
    - light.living_room
    - light.lounge
    - light.front_door
    - light.laundry
    - light.back_door
    - light.pool_room
    - light.carport
    - light.outside_front
    - light.verandah
    - input_boolean.sprinkler_control
    - input_boolean.homekit_location
    - media_player.living_room
    - media_player.bedroom
    - switch.heater_living_room_power
    - switch.vacuum
    - switch.triplej
    - switch.airplay_shed
    - switch.airplay_appletv
    - switch.airplay_bedroom
    - switch.lights
    - cover.roller_door
    - fan.verandah
    - climate.ac_bedroom
  entity_config:
    media_player.living_room:
      feature_list:
        - feature: on_off
#        - feature: play_pause
    media_player.bedroom:
      feature_list:
        - feature: on_off
#        - feature: play_pause
    switch.heater_living_room_power:
      name: Living Room Heater
    switch.vacuum:
      name: Vacuum Cleaner
    switch.triplej:
      name: Triple J
    switch.airplay_shed:
      name: Shed AirPlay
    switch.airplay_appletv:
      name: Living Room AirPlay
    switch.airplay_bedroom:
      name: Bedroom AirPlay



######################################################################################################
###----------------------------------------- NOTIFICATIONS ----------------------------------------###
######################################################################################################

ios:
  push:
    categories:
      - name: Roller Door
        identifier: 'roller_door_alert'
        actions:
          - identifier: 'ROLLER_DOOR_CLOSE'
            title: 'Close'
            activationMode: 'background'
            authenticationRequired: yes
            destructive: yes
            behavior: 'default'
          - identifier: 'IGNORE'
            title: 'Ignore'
            activationMode: 'background'
            authenticationRequired: yes
            destructive: no

      - name: Roller Door Camera Test
        identifier: 'camera'
        actions:
          - identifier: 'ROLLER_DOOR_CLOSE'
            title: 'Close'
            activationMode: 'background'
            authenticationRequired: yes
            destructive: yes
            behavior: 'default'
          - identifier: 'IGNORE'
            title: 'Ignore'
            activationMode: 'background'
            authenticationRequired: yes
            destructive: no

      - name: Roller Door
        identifier: 'roller_door_prompt'
        actions:
          - identifier: 'ROLLER_DOOR_OPEN'
            title: 'Open'
            activationMode: 'background'
            authenticationRequired: yes
            destructive: yes
          - identifier: 'IGNORE'
            title: 'Ignore'
            activationMode: 'background'
            authenticationRequired: no
            destructive: no

      - name: Door Bell
        identifier: 'door_bell_alert'
        actions:
          - identifier: 'IGNORE'
            title: 'Ignore'
            activationMode: 'background'
            authenticationRequired: no
            destructive: no
            
      - name: Sprinkler Alert
        identifier: 'sprinkler_alert'
        actions:
          - identifier: 'SPRINKLERS_OFF'
            title: 'Turn Off'
            activationMode: 'background'
            authenticationRequired: no
            destructive: no
          - identifier: 'IGNORE'
            title: 'Ignore'
            activationMode: 'background'
            authenticationRequired: no
            destructive: yes

      - name: Washing Machine Alert
        identifier: 'washing_machine_alert'
        actions:
          - identifier: 'IGNORE'
            title: 'Ignore'
            activationMode: 'background'
            authenticationRequired: no
            destructive: yes

      - name: Dishwasher Alert
        identifier: 'dishwasher_alert'
        actions:
          - identifier: 'IGNORE'
            title: 'Ignore'
            activationMode: 'background'
            authenticationRequired: no
            destructive: yes

######################################################################################################
###-------------------------------------------- TIMERS --------------------------------------------###
######################################################################################################
timer:
  sprinkler_zone_1:
  sprinkler_zone_2:
  sprinkler_zone_3:
  sprinkler_zone_4:
  
  sleep_bedroom:


######################################################################################################
###------------------------------------------- SWITCHES -------------------------------------------###
######################################################################################################
switch:
  - platform: broadlink
    host: 10.10.2.135
    mac: 'B4:43:0D:F9:1F:3A'
    switches:
      living_room_tv_power:
        friendly_name: "Living Room TV Power"
        command_on: 'JgAOAYKDEEIPQhBDEEIPIw8hEEIRIQ9DDyIPQw8iDyIPIw4iECIPQhFBECIQQg8iD0MQIg9CDwABKoKDEEIPRA5DD0MPIg8iEEIQIg9DDyIQQhAhDyIQIg4iECIPQw9CESEPQxAhD0MQIQ9DEAABKYGEEEIPQw9DEEIQIQ8iEEIQIRBCECIQQhAhECEPIg8iDyMPQhBCECIPQhAiEEIQIQ9DEAABKYGEEEIPQxBCD0MPIg8iD0MQIQ9DDyIQQhAhECIPIg8iDyIPQw9DECEPQw8iEEIPIhBCEAABKYKEEEIQQg9CEEIQIg8iD0MQIRBCECEQQg8iECEQIREhECEQQhBCECEPQxAhEEIQIRBCEAANBQAAAAAAAAAAAAA='
        command_off: 'JgAOAYKDEEIPQhBDEEIPIw8hEEIRIQ9DDyIPQw8iDyIPIw4iECIPQhFBECIQQg8iD0MQIg9CDwABKoKDEEIPRA5DD0MPIg8iEEIQIg9DDyIQQhAhDyIQIg4iECIPQw9CESEPQxAhD0MQIQ9DEAABKYGEEEIPQw9DEEIQIQ8iEEIQIRBCECIQQhAhECEPIg8iDyMPQhBCECIPQhAiEEIQIQ9DEAABKYGEEEIPQxBCD0MPIg8iD0MQIQ9DDyIQQhAhECIPIg8iDyIPQw9DECEPQw8iEEIPIhBCEAABKYKEEEIQQg9CEEIQIg8iD0MQIRBCECEQQg8iECEQIREhECEQQhBCECEPQxAhEEIQIRBCEAANBQAAAAAAAAAAAAA='
      living_room_audio_power:
        friendly_name: "Living Room Audio Power"
        command_on: 'JgBQAAABJpUUEhETEhMSOBITERURExITETkSOBI4FBERORE5EjgRORMSERQRFBEUEzcRFBETFBIROBI5ETgRORITETkUNhI4EQAFIgABJkwTAA0FAAAAAAAAAAA='
        command_off: 'JgBQAAABJpUUEhETEhMSOBITERURExITETkSOBI4FBERORE5EjgRORMSERQRFBEUEzcRFBETFBIROBI5ETgRORITETkUNhI4EQAFIgABJkwTAA0FAAAAAAAAAAA='
      living_room_audio_source:
        friendly_name: "Living Room Audio Source"
        # on = TV/optical
        command_on: 'JgBQAAABJ5YRFBETEhQROBITEhQRExITEjgSOBI4ERQSOBE5EjgRORE5EjgRFBI4ERMSFBEUERMSFBEUETgSFBE4EjgSORE4EQAFIgABJ0sRAA0FAAAAAAAAAAA=' 
        # off = MusicPi/3.5mm
        command_off: 'JgBYAAABKJQSExEVERMSOBITEhMRFBITEjgSOBE5EhMRORI4ETkROBIUETgSFBE4EhMSFBETEhMSOBITETkSExE5EjgSOBE5EgAFIQABJ0sRAAxaAAEnSxMADQU='
      living_room_audio_volume:
        friendly_name: "Living Room Audio Volume"
        # on = volume up
        command_on: 'JgBQAAABKZMTEhQRExITNxMSExEVERMSEzYTNxQ3ExEUNxM2EzcUNhQRFDYUERQ2FDYTEhQRFBETNhUREzYVERMSEzYUNhQ3EwAFHwABKUkUAA0FAAAAAAAAAAA='
        # off = volume down
        command_off: 'JgBQAAABKZMTEhQRFBETNxQRExITEhQREzYVNhM2FBITNhM3FDcTNhMTEzYTNxQ2FBEUERMSFBEUNhQRFBETEhM3EzYVNhM3EwAFHwABKUkUAA0FAAAAAAAAAAA='
      living_room_audio_mute:
        friendly_name: "Living Room Audio Mute"
        command_on: 'JgBQAAABKZIVERMSExEVNhMRFBETExMRFDcTNhM3FBETNxQ2FDYTNxQREzcUNhMSFDYTERURExITNxMSExEUNxMRFDcTNhM3FAAFHwABKUkTAA0FAAAAAAAAAAA='
        command_off: 'JgBQAAABKZIVERMSExEVNhMRFBETExMRFDcTNhM3FBETNxQ2FDYTNxQREzcUNhMSFDYTERURExITNxMSExEUNxMRFDcTNhM3FAAFHwABKUkTAA0FAAAAAAAAAAA='
      
      heater_living_room_power:
        friendly_name: "Living Room Heater Power"
        command_on: 'JgBIAAABKJUTExE5ERQRFBITEhQRFBE5EhMRORM4EhMRFBE5EjgTExEUETkSExEUETkSFBEUETkROREUEjkROREUETkSOREUEQANBQ=='
        command_off: 'JgBIAAABKJYRFBE5EhQRFBEUERQRFBE5EhQRORE5ERQRFBI5ETkRFBE5ERQSORE5ERQRFBEUETkSFBE5ERQRFBE5EjkROREUEQANBQ=='
      heater_living_room_temp:
        friendly_name: "Living Room Heater Temp"
        # on = up
        command_on: 'JgBIAAABKJYRFBE5ERQRFBEUEhQRFBE5ERQRORE6ERQRFBE5EjgRFBI5ERQSExE5ERQRFREUETkRFBE5EToRFBE5ETkRORIUEQANBQ=='
        # off = down
        command_off: 'JgBIAAABKZQSFBE5EhMRFBEUEhMSFBE5EhMRORI4ExMSExI4ETkRFBIUETkROREUEhMSExIUETkSOBEUEhMSORE5ETkSOBIUEgANBQ=='

  - platform: broadlink
    host: 10.10.2.136
    mac: '34:EA:34:42:BA:9F'
    switches:
      bedroom_tv_power:
        friendly_name: "Bedroom TV Power"
        command_on: 'JgBmAAo7ChoJGgkaCRoJGgk8CTwJGgo7CRoKGQkaCTwKGggABewKPAkaCRkKGgkaCTwJGgkZCjwJGgk8CTwKOwkbCTwJAAWnCTwKGQkbCRkKGQkbCTsKPAkZCjwJGgkaCRoJPAoZCQANBQAA='
        command_off: 'JgBmAAo7ChoJGgkaCRoJGgk8CTwJGgo7CRoKGQkaCTwKGggABewKPAkaCRkKGgkaCTwJGgkZCjwJGgk8CTwKOwkbCTwJAAWnCTwKGQkbCRkKGQkbCTsKPAkZCjwJGgkaCRoJPAoZCQANBQAA='

#    switches:
#      bedroom_tv_power:
#        friendly_name: "Bedroom TV Power"
#        command_on: 'JgDMAAw5CxkLFwwXCxkLFww6CzkMGAs5DBgLGAsXDDoLGAsABeoLOgwXCxgKGQsYCzsLFwsYCjsMFws6DDoLOQwYCjsLAAWlDDoLGAoZCxgKGQoZCzoLOgwXCjsMFwoaChgLOwsXCwAGNQw5CxkLFwsYCxkKOgwYCxgKOwsYCzoMOQs6CxgLOgwABaUMOQwXDBcLGAwXCxgLOgw6CxcMOgsYCxcMGAs5DBgLAAXpDDoLGAsYDBcLGAs6DBcLGAw5CxkLOQs6DDoLGAs6DAANBQAAAAAAAAAAAAAAAA'
#        command_off: 'JgDMAAw5CxkLFwwXCxkLFww6CzkMGAs5DBgLGAsXDDoLGAsABeoLOgwXCxgKGQsYCzsLFwsYCjsMFws6DDoLOQwYCjsLAAWlDDoLGAoZCxgKGQoZCzoLOgwXCjsMFwoaChgLOwsXCwAGNQw5CxkLFwsYCxkKOgwYCxgKOwsYCzoMOQs6CxgLOgwABaUMOQwXDBcLGAwXCxgLOgw6CxcMOgsYCxcMGAs5DBgLAAXpDDoLGAsYDBcLGAs6DBcLGAw5CxkLOQs6DDoLGAs6DAANBQAAAAAAAAAAAAAAAA'

  - platform: command_line
    switches:
#      triplej:
#        friendly_name: Triple J
#        command_on:
#          curl "http://MusicPi:3689/login?pairing-guid=0x1&request-session-id=50";
#          curl "http://MusicPi:3689/ctrl-int/1/playspec?database-spec='dmap.persistentid:0x1'&container-spec='dmap.persistentid:0x1'&container-item-spec='dmap.containeritemid:0x7'&session-id=50";
#          curl "http://MusicPi:3689/logout?session-id=50"
#        command_off:
#          curl "http://MusicPi:3689/login?pairing-guid=0x1&request-session-id=50";
#          curl "http://MusicPi:3689/ctrl-int/1/pause?session-id=50";
#          curl "http://MusicPi:3689/logout?session-id=50"
#        command_state: "/usr/bin/mpc -h MusicPi current"
#        value_template: '{{ value == "Triple J NSW - Triple J NSW" }}'

      triplej:
        friendly_name: Triple J
        command_on:
          curl "http://server-music.local:3689/login?request-session-id=50";
          curl "http://server-music.local:3689/ctrl-int/1/playspec?database-spec='dmap.persistentid:0x1'&container-spec='dmap.persistentid:0x1'&container-item-spec='dmap.containeritemid:0x7'&session-id=50";
          curl "http://server-music.local:3689/logout?session-id=50"
        command_off:
          curl "http://server-music.local:3689/login?request-session-id=50";
          curl "http://server-music.local:3689/ctrl-int/1/pause?session-id=50";
          curl "http://server-music.local:3689/logout?session-id=50"
        command_state: "/usr/bin/mpc -h server-music.local current"
        value_template: '{{ value == "Triple J NSW - Triple J NSW" }}'

      airplay_shed:
        friendly_name: Shed AirPlay
        command_on: "/usr/bin/mpc -h server-music.local enable 19358"
        command_off: "/usr/bin/mpc -h server-music.local disable 19358"
        command_state: "/usr/bin/mpc -h server-music.local outputs | grep 19358"
        value_template: '{{ value == "Output 19358 (MusicPi-Shed) is enabled" }}'

      airplay_living_room:
        friendly_name: Living Room AirPlay
        command_on: "/usr/bin/mpc -h server-music.local enable 51348"
        command_off: "/usr/bin/mpc -h server-music.local disable 51348"
        command_state: "/usr/bin/mpc -h server-music.local outputs | grep 51348"
        value_template: '{{ value == "Output 51348 (MusicPi) is enabled" }}'
      
      airplay_appletv:
        friendly_name: Apple TV AirPlay
        command_on: "/usr/bin/mpc -h server-music.local enable 30673"
        command_off: "/usr/bin/mpc -h server-music.local disable 30673"
        command_state: "/usr/bin/mpc -h server-music.local outputs | grep 30673"
        value_template: '{{ value == "Output 30673 (Living Room) is enabled" }}'
      
      airplay_bedroom:
        friendly_name: Bedroom AirPlay
        command_on: "/usr/bin/mpc -h server-music.local enable 53"
        command_off: "/usr/bin/mpc -h server-music.local disable 53"
        command_state: "/usr/bin/mpc -h server-music.local outputs | grep 53"
        value_template: '{{ value == "Output 53 (Bedroom) is enabled" }}'
      

  - platform: mqtt
    name: Sprinkler Zone 1
    state_topic: "node/sprinkler/006/state"
    command_topic: "node/sprinkler/006/command"
    payload_on: "1_on"
    payload_off: "1_off"

  - platform: mqtt
    name: Sprinkler Zone 2
    state_topic: "node/sprinkler/006/state"
    command_topic: "node/sprinkler/006/command"
    payload_on: "2_on"
    payload_off: "2_off"

  - platform: mqtt
    name: Sprinkler Zone 3
    state_topic: "node/sprinkler/006/state"
    command_topic: "node/sprinkler/006/command"
    payload_on: "3_on"
    payload_off: "3_off"

  - platform: mqtt
    name: Sprinkler Zone 4
    state_topic: "node/sprinkler/006/state"
    command_topic: "node/sprinkler/006/command"
    payload_on: "4_on"
    payload_off: "4_off"

  - platform: mqtt
    name: Sprinkler Zone 5
    state_topic: "node/sprinkler/006/state"
    command_topic: "node/sprinkler/006/command"
    payload_on: "5_on"
    payload_off: "5_off"

  - platform: mqtt
    name: Sprinkler Zone 6
    state_topic: "node/sprinkler/006/state"
    command_topic: "node/sprinkler/006/command"
    payload_on: "6_on"
    payload_off: "6_off"

  - platform: mqtt
    name: Sprinkler Zone 7
    state_topic: "node/sprinkler/006/state"
    command_topic: "node/sprinkler/006/command"
    payload_on: "7_on"
    payload_off: "7_off"

  - platform: mqtt
    name: Sprinkler Zone 8
    state_topic: "node/sprinkler/006/state"
    command_topic: "node/sprinkler/006/command"
    payload_on: "8_on"
    payload_off: "8_off"

  - platform: mqtt
    name: "Dafang Left Right"
    command_topic: "topic/dafang/set"
    payload_off: "motor_left"
    payload_on: "motor_right"
    optimistic: false

  - platform: template
    switches:
      sprinkler_timer_1:
        friendly_name: Sprinkler Zone 1 Timer
        value_template: "{{ is_state('timer.sprinkler_zone_1', 'active') }}"
        turn_on:
          service: timer.start
          data_template:
            entity_id: timer.sprinkler_zone_1
            duration: '00:{{states.input_number.sprinkler_timer_1.state | int}}:00'
        turn_off:
          service: timer.finish
          data:
            entity_id: timer.sprinkler_zone_1

      sprinkler_timer_2:
        friendly_name: Sprinkler Zone 2 Timer
        value_template: "{{ is_state('timer.sprinkler_zone_2', 'active') }}"
        turn_on:
          service: timer.start
          data_template:
            entity_id: timer.sprinkler_zone_2
            duration: '00:{{states.input_number.sprinkler_timer_2.state | int}}:00'
        turn_off:
          service: timer.finish
          data:
            entity_id: timer.sprinkler_zone_2

      sprinkler_timer_3:
        friendly_name: Sprinkler Zone 3 Timer
        value_template: "{{ is_state('timer.sprinkler_zone_3', 'active') }}"
        turn_on:
          service: timer.start
          data_template:
            entity_id: timer.sprinkler_zone_3
            duration: '00:{{states.input_number.sprinkler_timer_3.state | int}}:00'
        turn_off:
          service: timer.finish
          data:
            entity_id: timer.sprinkler_zone_3

      sprinkler_timer_4:
        friendly_name: Sprinkler Zone 4 Timer
        value_template: "{{ is_state('timer.sprinkler_zone_4', 'active') }}"
        turn_on:
          service: timer.start
          data_template:
            entity_id: timer.sprinkler_zone_4
            duration: '00:{{states.input_number.sprinkler_timer_4.state | int}}:00'
        turn_off:
          service: timer.finish
          data:
            entity_id: timer.sprinkler_zone_4

  - platform: template
    switches:
      vacuum:
        friendly_name: Vacuum
        entity_id: vacuum.xiaomi_vacuum_cleaner
        value_template: "{{ is_state('vacuum.xiaomi_vacuum_cleaner', 'cleaning') }}"
        turn_on:
          service: vacuum.start
          data:
            entity_id: vacuum.xiaomi_vacuum_cleaner
        turn_off:
          service: vacuum.return_to_base
          data:
            entity_id: vacuum.xiaomi_vacuum_cleaner


      ac_bedroom:
        friendly_name: Bedroom AC
        entity_id: climate.ac_bedroom
        value_template: "{{ is_state('climate.ac_bedroom', 'Auto') }}"
        turn_on:
          service: climate.set_operation_mode
          data:
            entity_id: climate.ac_bedroom
            operation_mode: 'Auto'
        turn_off:
          service: climate.set_operation_mode
          data:
            entity_id: climate.ac_bedroom
            operation_mode: 'Off'

      lights:
        friendly_name: "All Lights"
        value_template: "{{ is_state('group.lights', 'on') }}"
        turn_on:
          service: homeassistant.turn_on
          data:
            entity_id: group.lights
        turn_off:
          service: homeassistant.turn_off
          data:
            entity_id: group.lights

  - platform: flux
    lights:
      - light.flux
      - light.outside_front
#      - light.yeelight_rgb_7811dca21337
#      - light.yeelight_rgb_34ce008ce68b
#      - light.yeelight_rgb_34ce009133a2
    name: Flux
    start_time: '6:00'
    stop_time: '22:00'
    start_colortemp: 9000
    sunset_colortemp: 5500
    stop_colortemp: 2500
    disable_brightness_adjust: True
    mode: mired
    transition: 30
    interval: 30

######################################################################################################
###-------------------------------------------- COVERS --------------------------------------------###
######################################################################################################
cover:
  - platform: mqtt
    name: "Roller Door"
    state_topic: "node/cover/008/state"
    command_topic: "node/cover/008/command"
    payload_open: "OPEN"
    payload_close: "CLOSE"
    payload_stop: "STOP"
    state_open: "open"
    state_closed: "close"
    availability_topic: "node/cover/008/availability"
    payload_available: "online"
    payload_not_available: "offline"

######################################################################################################
###-------------------------------------------- INPUTS --------------------------------------------###
######################################################################################################

input_select:
  washing_machine_status:
    name: Washing Machine Status
    options:
      - Idle
      - Running
      - Finishing
      - Clean
    initial: Idle

  dishwasher_status:
    name: Dishwasher Status
    options:
      - Idle
      - Running
      - Finishing
      - Clean
    initial: Idle

  room_tracker:
    name: Last Room
    options:
    - Study
    - Laundry
    - Bedroom
    - Living Room
#    - Lounge
#    - Kitchen
#    - Front Door
    - Carport

  tablet_panel_detail:
    name: Active Tablet Detail Panel
    options:
    - Lights
    - Lights Advanced
    - Media
    - Cameras
    - Sprinklers
    - Sprinklers Advanced
    - Washer
    - Dishwasher
    - Alarm Clock
    - Vacuum Cleaner
    - Shed
    - Weather
    - Motion
    - Rooms
    - All

  tablet_panel_detail_rooms:
    name: Active Tablet Detail Rooms Panel
    options:
    - Bedroom
    - Study

input_number: 
  alarmclock_hour:
     name: Hour
     icon: mdi:timer
#     initial: 6
     min: 4
     max: 12
     step: 1
     mode: slider
  alarmclock_minutes:
     name: Minutes
     icon: mdi:timer
#     initial: 30
     min: 0
     max: 55
     step: 5
     mode: slider

  sprinkler_timer_1:
    name: Sprinkler Timer 1
    icon: mdi:timer
    min: 0
    max: 120
    step: 5
    mode: slider

  sprinkler_timer_2:
    name: Sprinkler Timer 2
    icon: mdi:timer
    min: 0
    max: 120
    step: 5
    mode: slider

  sprinkler_timer_3:
    name: Sprinkler Timer 3
    icon: mdi:timer
    min: 0
    max: 120
    step: 5
    mode: slider

  sprinkler_timer_4:
    name: Sprinkler Timer 4
    icon: mdi:timer
    min: 0
    max: 120
    step: 5
    mode: slider

  sprinkler_temp:
    name: Sprinkler Trigger Temp
    icon: mdi:thermometer
    unit_of_measurement: °C
    min: 10
    max: 40
    step: 1
    mode: slider

  dynamic_light_brightness:
    name: Dynamic Light Brightness
    icon: mdi:lightbulb-on
    unit_of_measurement: '%'
    min: 1
    max: 100
    mode: slider

  light_temp:
    name: Light Temperature
    icon: mdi:lightbulb-on
    unit_of_measurement: 'K'
    min: 2000
    max: 9000
    step: 100
    mode: slider

  living_room_volume_target:
    name: Living Room Volume Target
    min: 0
    max: 40
    step: 1
    
  living_room_volume_current:
    name: Living Room Volume
    min: 0
    max: 40
    step: 1


input_boolean:
  alarmclock_status:
    name: Alarm
    initial: on
    icon: mdi:alarm-check

  alarmclock_workday:
    name: Workdays Only
    initial: on
    icon: mdi:calendar

  light_check:
    name: Light Check
    icon: mdi:lightbulb-on
    initial: off

  homekit_control:
    name: Homekit Control
    initial: off

  motion_control:
    name: Motion Control
    icon: mdi:run
    initial: on

  sprinkler_control:
    name: Sprinkler Control
    icon: mdi:flower
    initial: off

  homekit_location:
    name: Homekit Location
    icon: mdi:account
  
  tile_media:
  tile_room_bedroom:
  tile_room_study:
  tile_room_living_room:
  tile_main_lights:
  tile_alarm_clock:
  tile_home:
  tile_bedroom_ac:
  tile_tablet_buttons:
  tile_tablet_detail:
  tile_tablet_status:
  tile_tablet_date:
  tile_weather:
  tile_tablet_dummy:
  
  tile_tablet_button_large:
  tile_tablet_button_lights:
  tile_tablet_button_lights_advanced:
  tile_tablet_button_media:
  tile_tablet_button_cameras:
  tile_tablet_button_sprinklers:
  tile_tablet_button_sprinklers_advanced:
  tile_tablet_button_washer:
  tile_tablet_button_dishwasher:
  tile_tablet_button_alarm_clock:
  tile_tablet_button_vacuum_cleaner:
  tile_tablet_button_shed:
  tile_tablet_button_weather:
  tile_tablet_button_motion:
  tile_tablet_button_rooms:
  
  
  tile_tablet_panel_lights:
  tile_tablet_panel_lights_advanced:
  tile_tablet_panel_media:
  tile_tablet_panel_cameras:
  tile_tablet_panel_sprinklers:
  tile_tablet_panel_sprinklers_advanced:
  tile_tablet_panel_washer:
  tile_tablet_panel_dishwasher:
  tile_tablet_panel_alarm_clock:
  tile_tablet_panel_vacuum_cleaner:
  tile_tablet_panel_shed:
  tile_tablet_panel_weather:
  tile_tablet_panel_motion:
  tile_tablet_panel_rooms:
  
  tile_tablet_panel_rooms_bedroom:
  tile_tablet_panel_rooms_study:
  
  

######################################################################################################
###----------------------------------------- BINARY SENSORS ---------------------------------------###
######################################################################################################
binary_sensor:
  - platform: workday
    country: AU
    province: SA
    workdays: [ mon, tue, wed, thu, fri ]

  - platform: workday
    name: Workday Tomorrow
    country: AU
    province: SA
    workdays: [ mon, tue, wed, thu, fri ]
    days_offset: 1

  - platform: mqtt
    name: Living Room TV Power Status
    state_topic: "node/power/004"
    payload_on: "on"
    payload_off: "off"
    device_class: power

  - platform: template
    sensors:
      alarmclock_tomorrow:
        friendly_name: "Alarm Clock Tomorrow"
        value_template: >-
          {% if is_state('input_boolean.alarmclock_status', 'off') %}
            False
          {% elif is_state('input_boolean.alarmclock_workday', 'on') and is_state('binary_sensor.workday_tomorrow', 'on') %}
            True
          {% elif is_state('input_boolean.alarmclock_workday', 'off') %}
            True
          {% else %}
            False
          {% endif %} 
             

######################################################################################################
###-------------------------------------------- SENSORS -------------------------------------------###
######################################################################################################
sensor:
#  - platform: google_travel_time
#    name: travel_city
#    api_key: !secret google_api_key
#    origin: zone.home
#    destination: !secret city_address
#    options:
#      mode: driving

#  - platform: google_travel_time
#    name: travel_work
#    api_key: !secret google_api_key
#    origin: zone.home
#    destination: !secret work_address
#    options:
#      mode: driving

#  - platform: google_travel_time
#    name: travel_home
#    api_key: !secret google_api_key
#    origin: device_tracker.danielsiphone6splus
#    destination: zone.home
#    options:
#      mode: driving

  - platform: pi_hole
    host: 10.1.0.4
    monitored_conditions:
    - ads_blocked_today
    - ads_percentage_today
    - queries_forwarded
    - dns_queries_today
  
  - platform: plex
    host: server.local
  
  - platform: speedtest
    monitored_conditions:
      - ping
      - download
      - upload

  - platform: time_date
    display_options:
    - 'time'
    - 'date'

  - platform: openhardwaremonitor
    host: server.local

  - platform: darksky
    api_key: !secret darksky_api_key
    monitored_conditions:
    - summary
    - precip_intensity
    - precip_probability
    - temperature
    - cloud_cover
    - humidity
    - temperature_high
    - temperature_low
    - hourly_summary

  - platform: wunderground
    api_key: 0235d75e48901961
    monitored_conditions:
    - alerts
    - precip_today_metric
    - precip_1d_mm
    - precip_1d
    - precip_2d_mm
    - precip_2d
    - precip_3d_mm
    - precip_3d
    - relative_humidity
    - temp_c
    - temp_high_1d_c
    - temp_low_1d_c
    - temp_high_2d_c
    - temp_low_2d_c
    - wind_gust_kph
    - wind_gust_1d_kph
    - wind_kph
    - wind_1d_kph
    - weather
    - weather_1d_metric
    - weather_1n_metric

  - platform: template
    sensors:
      alarmclock_time:
        friendly_name: 'Alarm Clock Time'
        value_template: '{{ "%0.02d:%0.02d" | format(states("input_number.alarmclock_hour") | int, states("input_number.alarmclock_minutes") | int) }}'    
      
#  - platform: template
#    sensors:
#      battery_danielsiphone6splus:
#        unit_of_measurement: '%'
#        value_template: >-
#            {%- if states.device_tracker.danielsiphone6splus.attributes.battery %}
#                {{ states.device_tracker.danielsiphone6splus.attributes.battery|round }}
#            {% else %}
#                {{ states.sensor.battery_iphone.state }}
#            {%- endif %}
      
      washing_machine_power:
        friendly_name: Washing Machine Power Usage
#        entity_id: switch.plug_158d0001db1baf
        unit_of_measurement: 'watts'
        value_template: "{{ states.switch.plug_158d0001db1baf.attributes.load_power }}"
      
      dishwasher_power:
        friendly_name: Dishwasher Power Usage
#        entity_id: switch.plug_158d0001dc90d1
        unit_of_measurement: 'watts'
        value_template: "{{ states.switch.plug_158d0001dc90d1.attributes.load_power }}"
      
#      living_room_tv:
#        value_template: >-
#            {% if is_state('device_tracker.living_room_tv', 'home') %}
#                on
#            {% else %}
#                off
#            {% endif %}

  - platform: template
    sensors:
      friendly_date:
        friendly_name: Current Date
        value_template: "{{ now().strftime('%d %B') }}"

  - platform: bom
    zone_id: !secret bom_zone_id
    wmo_id: !secret bom_wmo_id
    monitored_conditions:
    - rain_trace
    - wind_spd_kmh

  - platform: time_date
    display_options:
    - 'time'
    - 'date'
    - 'date_time'
    - 'time_date'
    - 'time_utc'
    - 'beat'

  - platform: sonarr
    api_key: !secret sonarr_api_key
    host: server.local
    monitored_conditions:
    - series
    - upcoming
    - queue
    - diskspace
    days: 3
    urlbase: /sonarr
    include_paths:
      - M:\
    
  - platform: radarr
    api_key: !secret radarr_api_key
    host: server.local
    monitored_conditions:
    - movies
    - upcoming
#    - diskspace
    days: 3
    urlbase: /radarr
#    include_paths:
#      - C:\

  - platform: template
    sensors:
      location_daniel:
        value_template: >-
            {% if is_state('input_boolean.homekit_location', 'on') %}
                Home
            {% else %}
                Away
            {% endif %}
        friendly_name: Daniel

  - platform: template
    sensors:
      washing_machine_status:
        value_template: '{{ states.input_select.washing_machine_status.state}}'
        friendly_name: 'Washing Machine'

      dishwasher_status:
        value_template: '{{ states.input_select.dishwasher_status.state}}'
        friendly_name: 'Dishwasher'
      
      sprinkler_status:
        value_template: '{{ states.group.irrigation.state}}'
        friendly_name: 'Sprinklers'

#  - platform: rest
#    name: SC Tiles latest version
#    resource: https://raw.githubusercontent.com/c727/home-assistant-tiles/master/LATEST_VERSION

  - platform: mqtt
    name: /plant_1_moisture
    state_topic: /plant/plant_1/
    value_template: '{{ value_json.moisture }}'
    unit_of_measurement: '%'
  - platform: mqtt
    name: plant_1_battery
    state_topic: /plant/plant_1/
    value_template: '{{ value_json.battery }}'
  - platform: mqtt
    name: plant_1_temperature
    state_topic: /plant/plant_1/
    value_template: '{{ value_json.temperature }}'
    unit_of_measurement: '°C'
  - platform: mqtt
    name: plant_1_conductivity
    state_topic: /plant/plant_1/
    value_template: '{{ value_json.conductivity }}'
    unit_of_measurement: 'μS/cm'
  - platform: mqtt
    name: plant_1_brightness
    state_topic: /plant/plant_1/
    value_template: '{{ value_json.brightness }}'
    unit_of_measurement: 'lux'

######################################################################################################
###--------------------------------------------- OTHER --------------------------------------------###
######################################################################################################

plant:
  peace_lily:
    sensors:
      moisture: sensor.plant_1_moisture
#      battery: sensor.plant_1_battery
      temperature: sensor.plant_1_temperature
      conductivity: sensor.plant_1_conductivity
      brightness: sensor.plant_1_brightness
    min_moisture: 15
    max_moisture: 65