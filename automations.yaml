- alias: Home Assistant Start
  trigger:
    platform: homeassistant
    event: start
  action:
  - service: homeassistant.turn_on
    entity_id:
    - switch.flux
    - light.flux
  - service: input_select.select_option
    data:
      entity_id: input_select.tablet_panel_detail
      option: Lights
  - service: group.set_visibility
    entity_id:
    - group.tile_tablet_panel_lights_advanced
    - group.tile_tablet_panel_media
    - group.tile_tablet_panel_cameras
    - group.tile_tablet_panel_sprinklers
    - group.tile_tablet_panel_sprinklers_advanced
    - group.tile_tablet_panel_washer
    - group.tile_tablet_panel_dishwasher
    - group.tile_tablet_panel_alarm_clock
    - group.tile_tablet_panel_vacuum_cleaner
    - group.tile_tablet_panel_shed
    - group.tile_tablet_panel_weather
    - group.tile_tablet_panel_motion
    data:
      visible: False

#######################################################################################################
###--------------------------------------- LIGHT AUTOMATIONS ---------------------------------------###
#######################################################################################################

# LIGHT CHECK #########################################################################################
- alias: Light Check Sunset
  trigger:
    platform: sun
    event: sunset
    offset: "-00:30:00"
  action:
    service: homeassistant.turn_on
    entity_id: input_boolean.light_check

- alias: Light Check Sunrise
  trigger:
    platform: sun
    event: sunrise
  action: 
    service: homeassistant.turn_off
    entity_id: input_boolean.light_check
    
- alias: Light Check Startup
  trigger: 
    platform: homeassistant
    event: start
  condition:
    condition: or
    conditions:
    - condition: sun
      after: sunset
      after_offset: "-00:30:00"
    - condition: sun
      before: sunrise
  action:
    service: homeassistant.turn_on
    entity_id: input_boolean.light_check


# LIGHT CONTROL #######################################################################################
- alias: Turn on Lights When I Get Home
  trigger:
    platform: state
    entity_id: sensor.location_daniel
    to: 'Home'
  condition:
    condition: state
    entity_id: input_boolean.light_check
    state: 'on'
  action:
    service: homeassistant.turn_on
    entity_id:
      - group.welcome_lights
      - light.living_room
    data:
      transition: 5

- alias: Turn on Light If I'm Home
  trigger:
    platform: sun
    event: sunset
    offset: "-00:30:00"
  condition:
    condition: state
    entity_id: sensor.location_daniel
    state: 'Home'
  action:
    service: homeassistant.turn_on
    entity_id: light.living_room
    data:
      transition: 90

- alias: Turn off Welcome Lights
  trigger:
    platform: state
    entity_id: group.welcome_control_lights
    from: 'off'
    to: 'on'
  action:
    service: homeassistant.turn_off
    entity_id: group.welcome_lights
    data:
      transition: 5

- alias: Turn on Backdoor + Carport Lights When Roller Door Opens
  trigger:
    platform: state
    entity_id: cover.roller_door
    from: 'closed'
    to: 'open'
  condition:
    condition: state
    entity_id: input_boolean.light_check
    state: 'on'
  action:
  - service: homeassistant.turn_on
    entity_id: light.back_door
    data:
      transition: 2
  - service: homeassistant.turn_on
    entity_id: light.carport

- alias: Fade off front lights
  trigger:
    platform: state
    entity_id: light.yeelight_rgb_34ce008ce68b
    from: 'unavailable'
    to: 'on'
    for:
      minutes: 2
  action:
    service: homeassistant.turn_off
    entity_id:
      - light.yeelight_rgb_34ce008ce68b
      - light.yeelight_rgb_34ce009133a2
    data:
      transition: 10


# LIGHT BRIGHTNESS #######################################################################################
- alias: Dynamic Brightness Reset
  trigger:
    platform: sun
    event: sunrise
  action:
    service: input_number.set_value
    data:
      entity_id: input_number.dynamic_light_brightness
      value: 100
 

- alias: Dynamic Brightness 10 PM
  trigger:
    platform: time
    at: '22:00:00'
  action:
    service: input_number.set_value
    data:
      entity_id: input_number.dynamic_light_brightness
      value: 75

- alias: Dynamic Brightness 11 PM
  trigger:
    platform: time
    at: '23:00:00'
  action:
    service: input_number.set_value
    data:
      entity_id: input_number.dynamic_light_brightness
      value: 50

- alias: Dynamic Brightness 12 AM
  trigger:
    platform: time
    at: '00:00:00'
  action:
    service: input_number.set_value
    data:
      entity_id: input_number.dynamic_light_brightness
      value: 30

- alias: Dynamic Brightness 1 AM
  trigger:
    platform: time
    at: '01:00:00'
  action:
    service: input_number.set_value
    data:
      entity_id: input_number.dynamic_light_brightness
      value: 20

# LIGHT COLOUR #######################################################################################

- alias: Set LIFX colour temperature
  trigger:
    platform: state
    entity_id: input_number.light_temp
  action:
    service: light.lifx_set_state
    data:
      transition: 5
    data_template:
      kelvin: '{{states.input_number.light_temp.state | int}}'
      
      
- alias: Set light colour temperature
  trigger:
    platform: time
    minutes: /15
  action:
    service: input_number.set_value
    data:
      entity_id: input_number.light_temp
    data_template:
      value: '{{( 1000000 / states.light.flux.attributes.color_temp ) | int}}'





#######################################################################################################
###--------------------------------------- MOTION AUTOMATIONS --------------------------------------###
#######################################################################################################

# WARDROBE ############################################################################################
- alias: Motion Detect - Wardrobe
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_wardrobe
    from: 'off'
    to: 'on'
  action:
  - service: homeassistant.turn_on
    entity_id: light.wardrobe
    data_template:
      transition: 2
      brightness_pct: '{{states.input_number.dynamic_light_brightness.state}}'

- alias: Motion Clear - Wardrobe
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_wardrobe
    from: 'on'
    to: 'off'
  action:
    service: homeassistant.turn_off
    entity_id: light.wardrobe
    data:
      transition: 5

# LAUNDRY #############################################################################################
- alias: Motion Detect - Laundry
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_laundry
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: input_boolean.light_check
    state: 'on'
  action:
  - service: homeassistant.turn_on
    entity_id: light.laundry
    data_template:
      transition: 2
      brightness_pct: '{{states.input_number.dynamic_light_brightness.state}}'
  - service: input_select.select_option
    data:
      entity_id: input_select.room_tracker
      option: Laundry

- alias: Motion Clear - Laundry
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_laundry
    from: 'on'
    to: 'off'
  condition:
    condition: state
    entity_id: input_boolean.light_check
    state: 'on'
  action:
    service: homeassistant.turn_off
    entity_id: light.laundry
    data:
      transition: 5

# BEDROOM #############################################################################################
- alias: Motion Detect - Bedroom
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_bedroom
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: input_boolean.light_check
    state: 'on'
  action:
  - service: homeassistant.turn_on
    entity_id: light.bedroom
    data_template:
      transition: 2
      brightness_pct: '{{states.input_number.dynamic_light_brightness.state}}'

- alias: Motion Clear - Bedroom
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_bedroom
    from: 'on'
    to: 'off'
    for:
      minutes: 5
  condition:
    condition: state
    entity_id: input_boolean.light_check
    state: 'on'
  action:
    service: homeassistant.turn_off
    entity_id: light.bedroom
    data:
      transition: 5

# ENSUITE #############################################################################################
- alias: Motion Detect - Ensuite
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_ensuite
    from: 'off'
    to: 'on'
  action:
  - service: homeassistant.turn_on
    entity_id: light.yeelight_rgb_7811dca21337
    data_template:
      transition: 2
      brightness_pct: '{{states.input_number.dynamic_light_brightness.state}}'
      kelvin: '{{states.input_number.light_temp.state | int}}'

- alias: Motion Clear - Ensuite (No Shower)
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_ensuite
    from: 'on'
    to: 'off'
    for:
      minutes: 2
  condition:
    condition: numeric_state
    entity_id: sensor.humidity_158d0001f52bfc
    below: 75
  action:
    service: homeassistant.turn_off
    entity_id: light.yeelight_rgb_7811dca21337
    data:
      transition: 5

- alias: Motion Clear - Ensuite (Shower)
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_ensuite
    from: 'on'
    to: 'off'
    for:
      minutes: 20
  condition:
    condition: numeric_state
    entity_id: sensor.humidity_158d0001f52bfc
    above: 75
  action:
    service: homeassistant.turn_off
    entity_id: light.yeelight_rgb_7811dca21337
    data:
      transition: 5

# STUDY #############################################################################################
- alias: Motion Detect - Study
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_study
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: input_boolean.light_check
    state: 'on'
  action:
  - service: homeassistant.turn_on
    entity_id: light.study
    data:
      transition: 2

- alias: Motion Clear - Study
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_study
    from: 'on'
    to: 'off'
    for:
      minutes: 10
  condition:
    condition: state
    entity_id: input_boolean.light_check
    state: 'on'
  action:
    service: homeassistant.turn_off
    entity_id: light.study
    data:
      transition: 5

# LIVING ROOM #############################################################################################
- alias: Motion Detect - Living Room
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_living_room
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: input_boolean.light_check
    state: 'on'
  action:
  - service: homeassistant.turn_on
    entity_id: light.living_room
    data:
      transition: 2

- alias: Motion Clear - Living Room
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_living_room
    from: 'on'
    to: 'off'
    for:
      minutes: 30
  condition:
    condition: state
    entity_id: input_boolean.light_check
    state: 'on'
  action:
    service: homeassistant.turn_off
    entity_id: light.living_room
    data:
      transition: 5


# KITCHEN #############################################################################################
- alias: Motion Detect - Kitchen
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_kitchen
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: input_boolean.light_check
    state: 'on'
  action:
  - service: homeassistant.turn_on
    entity_id: light.kitchen
    data_template:
      transition: 2
      brightness_pct: '{{states.input_number.dynamic_light_brightness.state}}'

- alias: Motion Clear - Kitchen
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_kitchen
    from: 'on'
    to: 'off'
    for:
      minutes: 5
  condition:
    condition: state
    entity_id: input_boolean.light_check
    state: 'on'
  action:
    service: homeassistant.turn_off
    entity_id: light.kitchen
    data:
      transition: 5

# FRONT DOOR #############################################################################################
- alias: Motion Detect - Front Door
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_front_door
    from: 'off'
    to: 'on'
  action:
  - service: mqtt.publish
    data:
      topic: "tablet/1"
      payload: "on"

- alias: Motion Clear - Front Door
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_front_door
    from: 'on'
    to: 'off'
  action:
    - service: mqtt.publish
      data:
        topic: "tablet/1"
        payload: "off"


#######################################################################################################
###----------------------------------- ROOM TRACKER AUTOMATIONS ------------------------------------###
#######################################################################################################

- alias: Room Tracker - Bedroom
  trigger:
    platform: state
    entity_id: input_select.room_tracker
    to: "Bedroom"
    for:
      minutes: 2
  action:
  - service: homeassistant.turn_off
    entity_id:
    - group.lights_outside
    - light.living_room
    - light.study
    - light.front_door
    - light.kitchen
    - light.lounge
    - light.laundry
    data:
      transition: 4

- alias: Room Tracker - Study
  trigger:
    platform: state
    entity_id: input_select.room_tracker
    to: "Study"
    for:
      minutes: 2
  action:
  - service: homeassistant.turn_off
    entity_id:
    - group.lights_outside
    - light.living_room
    - light.bedroom
    - light.wardrobe
    - light.ensuite
    - light.front_door
    - light.kitchen
    - light.lounge
    - light.laundry
    data:
      transition: 4

- alias: Room Tracker - Bedroom Motion Detect
  trigger:
    platform: state
    entity_id: group.room_tracker_motion_bedroom_all
    to: 'on'
  action:
  - service: input_select.select_option
    data:
      entity_id: input_select.room_tracker
      option: Bedroom

- alias: Room Tracker - Bedroom Motion Clear
  trigger:
    platform: state
    entity_id: group.room_tracker_motion_bedroom_all
    to: 'off'
  condition:
    condition: state
    entity_id: input_select.room_tracker
    state: 'Bedroom'
  action:
  - service: input_select.select_option
    data_template:
      entity_id: input_select.room_tracker
      option: >-
        {% if is_state('binary_sensor.motion_sensor_front_door', 'on') %}
          Front Door
        {% elif is_state('binary_sensor.motion_sensor_living_room', 'on') %}
          Living Room
        {% endif %}

- alias: Room Tracker - Front Door Motion Detect
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_front_door
    to: 'on'
  action:
  - service: input_select.select_option
    data:
      entity_id: input_select.room_tracker
      option: Front Door

- alias: Room Tracker - Front Door Motion Clear
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_front_door
    to: 'off'
  condition:
    condition: state
    entity_id: input_select.room_tracker
    state: 'Front Door'
  action:
  - service: input_select.select_option
    data_template:
      entity_id: input_select.room_tracker
      option: >-
        {% if is_state('binary_sensor.motion_sensor_bedroom', 'on') %}
          Bedroom
        {% elif is_state('binary_sensor.motion_sensor_living_room', 'on') %}
          Living Room
        {% endif %}

- alias: Room Tracker - Kitchen Motion Detect
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_kitchen
    to: 'on'
  action:
  - service: input_select.select_option
    data:
      entity_id: input_select.room_tracker
      option: Kitchen

- alias: Room Tracker - Kitchen Motion Clear
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_kitchen
    to: 'off'
  condition:
    condition: state
    entity_id: input_select.room_tracker
    state: 'Kitchen'
  action:
  - service: input_select.select_option
    data_template:
      entity_id: input_select.room_tracker
      option: >-
        {% if is_state('binary_sensor.motion_sensor_living_room', 'on') %}
          Living Room
        {% endif %}

- alias: Room Tracker - Study Motion Detect
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_study
    to: 'on'
  action:
  - service: input_select.select_option
    data:
      entity_id: input_select.room_tracker
      option: Study

- alias: Room Tracker - Study Motion Clear
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_study
    to: 'off'
  condition:
    condition: state
    entity_id: input_select.room_tracker
    state: 'Study'
  action:
  - service: input_select.select_option
    data_template:
      entity_id: input_select.room_tracker
      option: >-
        {% if is_state('binary_sensor.motion_sensor_living_room', 'on') %}
          Living Room
        {% endif %}

- alias: Room Tracker - Living Room Motion Detect
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_living_room
    to: 'on'
  action:
  - service: input_select.select_option
    data:
      entity_id: input_select.room_tracker
      option: Living Room

- alias: Room Tracker - Living Room Motion Clear
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_living_room
    to: 'off'
  condition:
    condition: state
    entity_id: input_select.room_tracker
    state: 'Bedroom'
  action:
  - service: input_select.select_option
    data_template:
      entity_id: input_select.room_tracker
      option: >-
        {% if is_state('binary_sensor.motion_sensor_study', 'on') %}
          Study
        {% elif is_state('binary_sensor.motion_sensor_lounge', 'on') %}
          Lounge
        {% elif is_state('binary_sensor.motion_sensor_kitchen', 'on') %}
          Kitchen
        {% elif is_state('binary_sensor.motion_sensor_front_door', 'on') %}
          Front Door
        {% elif is_state('binary_sensor.motion_sensor_bedroom', 'on') %}
          Bedroom
        {% endif %}

#######################################################################################################
###--------------------------------------- BUTTON AUTOMATIONS --------------------------------------###
#######################################################################################################

- alias: Button - Door Bell
  trigger:
    platform: event
    event_type: click
    event_data:
      entity_id: binary_sensor.switch_158d00016c131e
  action:
  - service: script.door_bell
  - service: notify.ios_danielsiphone6splus
    data:
      message: "Door Bell Pressed!"
      data:
        push:
          badge: 2
          category: "door_bell_alert"
#  - service: script.sprinkler_burst

- alias: Button - Roller Door
  trigger:
  - platform: event
    event_type: click
    event_data:
      entity_id: binary_sensor.switch_158d00016be070
  - platform: event
    event_type: click
    event_data:
      entity_id: binary_sensor.switch_158d0001b12757
  action:
    service: script.toggle_roller_door

- alias: Button - Carport Light
  trigger:
    platform: event
    event_type: click
    event_data:
      entity_id: binary_sensor.switch_158d0001e41a2c
  action:
    service: homeassistant.toggle
    entity_id: light.carport

#######################################################################################################
###--------------------------------------- OTHER AUTOMATIONS ---------------------------------------###
#######################################################################################################
- alias: Turn off Stuff When I Leave Home
  trigger:
    platform: state
    entity_id: sensor.location_daniel
    from: 'Home'
    to: 'Away'
  action:
  - service: homeassistant.turn_off
    entity_id:
      - group.lights
    data:
      transition: 10
  - service: homeassistant.turn_off
    entity_id:
      - switch.triplej

- alias: Run Vacuum Cleaner
  trigger:
    platform: state
    entity_id: sensor.location_daniel
    from: 'Home'
    to: 'Away'
  condition:
    condition: and
    conditions:
    - condition: time
      before: '17:00:00'
    - condition: template
      value_template: '{{ as_timestamp(now()) - as_timestamp(states.automation.run_vacuum_cleaner.attributes.last_triggered) | int > 129600 }}'
  action:
  - service: homeassistant.turn_on
    entity_id: vacuum.xiaomi_vacuum_cleaner
    
- alias: Stop Vacuum Cleaner
  trigger:
    platform: state
    entity_id: sensor.location_daniel
    to: 'Home'
  action:
  - service: homeassistant.turn_off
    entity_id: vacuum.xiaomi_vacuum_cleaner

- alias: Alarm Clock
  trigger:
    platform: template
    value_template: '{{ states.sensor.time.state == states.sensor.alarmclock_time.state }}'
  condition:
    condition: or
    conditions:
    - condition: and
      conditions:
      - condition: state
        entity_id: input_boolean.alarmclock_workday
        state: 'on'
      - condition: state
        entity_id: binary_sensor.workday_sensor
        state: 'on'
    - condition: state
      entity_id: input_boolean.alarmclock_workday
      state: 'off'
  action:
  - service: homeassistant.turn_on
    entity_id:
      - light.bedroom
    data:
      brightness: 255
      transition: 5
  - service: homeassistant.turn_off
    entity_id:
      - switch.airplay_shed
      - switch.airplay_appletv
  - service: homeassistant.turn_on
    entity_id:
      - switch.airplay_living_room
      - switch.triplej

- alias: SC Tiles update info
  trigger:
    platform: state
    entity_id: sensor.sc_tiles_latest_version
  action:
    service: persistent_notification.create
    data:
      title: Update available
      message: A new version for [Tiles custom state card](https://github.com/c727/home-assistant-tiles#changelog) is available.

#######################################################################################################
###------------------------------------- IRRIGATION AUTOMATIONS ------------------------------------###
#######################################################################################################

- alias: Sprinkler Zone 1 On
  trigger:
  - platform: state
    entity_id: timer.sprinkler_zone_1
    to: 'active'
  action:
  - service: homeassistant.turn_on
    entity_id: switch.sprinkler_zone_1

- alias: Sprinkler Zone 1 Off
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.sprinkler_zone_1
  action:
  - service: homeassistant.turn_off
    entity_id: switch.sprinkler_zone_1

- alias: Sprinkler Zone 2 On
  trigger:
  - platform: state
    entity_id: timer.sprinkler_zone_2
    to: 'active'
  action:
  - service: homeassistant.turn_on
    entity_id: switch.sprinkler_zone_2

- alias: Sprinkler Zone 2 Off
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.sprinkler_zone_2
  action:
  - service: homeassistant.turn_off
    entity_id: switch.sprinkler_zone_2

- alias: Sprinkler Zone 3 On
  trigger:
  - platform: state
    entity_id: timer.sprinkler_zone_3
    to: 'active'
  action:
  - service: homeassistant.turn_on
    entity_id: switch.sprinkler_zone_3

- alias: Sprinkler Zone 3 Off
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.sprinkler_zone_3
  action:
  - service: homeassistant.turn_off
    entity_id: switch.sprinkler_zone_3

- alias: Sprinkler Zone 4 On
  trigger:
  - platform: state
    entity_id: timer.sprinkler_zone_4
    to: 'active'
  action:
  - service: homeassistant.turn_on
    entity_id: switch.sprinkler_zone_4

- alias: Sprinkler Zone 4 Off
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.sprinkler_zone_4
  action:
  - service: homeassistant.turn_off
    entity_id: switch.sprinkler_zone_4






- alias: Sprinkler Warning
  trigger:
    - platform: state
      entity_id: group.irrigation
      to: 'on'
      for:
        seconds: 20
    - platform: state
      entity_id: group.irrigation
      to: 'on'
      for:
        minutes: 30
    - platform: state
      entity_id: group.irrigation
      to: 'on'
      for:
        hours: 1
    - platform: state
      entity_id: group.irrigation
      to: 'on'
      for:
        hours: 2
  action:
    service: notify.ios_danielsiphone6splus
    data:
      message: "Sprinklers Left On!"
      data:
        push:
          badge: 1
          category: "sprinkler_alert"
    
- alias: Turn off sprinklers
  trigger:
    platform: event
    event_type: ios.notification_action_fired
    event_data:
      actionName: SPRINKLERS_OFF
  action:
    service: homeassistant.turn_off
    entity_id:
      - group.irrigation

- alias: Turn on sprinklers
  trigger: 
    platform: sun
    event: sunrise
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: '{{states.sensor.pws_temp_high_1d_c.state > states.input_number.sprinkler_temp.state}}'
      - condition: numeric_state
        entity_id: sensor.pws_precip_1d_mm
        below: 2
  action:
    service: homeassistant.turn_on
    entity_id: input_boolean.sprinkler_control

- alias: Sprinkler Control On
  trigger:
    platform: state
    entity_id: input_boolean.sprinkler_control
    to: 'on'
  action:
    service: script.sprinklers

- alias: Sprinkler Control Off
  trigger:
    platform: state
    entity_id: input_boolean.sprinkler_control
    to: 'off'
  action:
  - service: homeassistant.turn_off
    entity_id:
    - group.irrigation
    - script.sprinklers
  - service: timer.finish
    entity_id:
    - timer.sprinkler_zone_1
    - timer.sprinkler_zone_2
    - timer.sprinkler_zone_3
    - timer.sprinkler_zone_4



#######################################################################################################
###--------------------------------------- AUDIO AUTOMATIONS ---------------------------------------###
#######################################################################################################

- alias: Toggle TV state
  trigger:
    platform: state
    entity_id:
      - switch.living_room_tv
    from: 'on'
    to: 'off'
  action:
    service: homeassistant.state
    entity_id:
      - sensor.living_room_tv
    data:
      state: off
      
- alias: Toggle TV audio on when TV turns on
  trigger:
    platform: state
    entity_id:
      - media_player.living_room_tv
    from: 'off'
    to: 'on'
  action:
    service: homeassistant.turn_on
    entity_id:
      - switch.living_room_audio_source

- alias: Toggle TV audio off when TV turns off
  trigger:
    platform: state
    entity_id:
      - media_player.living_room_tv
    from: 'on'
    to: 'off'
  action:
    service: homeassistant.turn_off
    entity_id:
      - switch.living_room_audio_source

- alias: Toggle TV audio on when Apple TV starts playing
  trigger:
    platform: state
    entity_id:
    - media_player.apple_tv
    to: 'playing'
  action:
    service: homeassistant.turn_on
    entity_id:
    - switch.living_room_audio_source

- alias: Switch to 3.5mm audio when Triple J starts
  trigger:
    platform: state
    entity_id: switch.triplej
    from: 'off'
    to: 'on'
  action:
    service: homeassistant.turn_off
    entity_id: 
    - switch.living_room_audio_source

- alias: Switch to 3.5mm audio when Living Room AirPlay turns on
  trigger:
    platform: state
    entity_id: switch.airplay_living_room
    from: 'off'
    to: 'on'
  action:
    service: homeassistant.turn_off
    entity_id: 
    - switch.living_room_audio_source

#######################################################################################################
###--------------------------------------- COVER AUTOMATIONS ---------------------------------------###
#######################################################################################################

- alias: Close the roller door
  trigger:
    platform: event
    event_type: ios.notification_action_fired
    event_data:
      actionName: ROLLER_DOOR_CLOSE
  action:
    service: cover.close_cover
    entity_id:
      - cover.roller_door

- alias: Open the roller door
  trigger:
    platform: event
    event_type: ios.notification_action_fired
    event_data:
      actionName: ROLLER_DOOR_OPEN
  action:
    service: cover.open_cover
    entity_id:
      - cover.roller_door

- alias: Notify if roller door opens while I'm away
  trigger:
    platform: state
    entity_id: cover.roller_door
    from: 'closed'
    to: 'open'
  condition:
    condition: state
    entity_id: sensor.location_daniel
    state: 'Away'
  action:
    service: notify.ios_danielsiphone6splus
    data:
      message: "Roller Door Opened!"
      data:
        attachment:
          content-type: jpeg
        push:
          badge: 5
          category: camera
        entity_id: camera.shed


- alias: Notify if roller door is open when I leave home
  trigger:
    platform: state
    entity_id: sensor.location_daniel
    from: 'Home'
    to: 'Away'
  condition:
    condition: state
    entity_id: cover.roller_door
    state: 'open'
  action:
    service: notify.ios_danielsiphone6splus
    data:
      message: "Roller Door Left Open!"
      data:
        push:
          badge: 5
          category: "roller_door_alert"

- alias: Notify if roller door is left open
  trigger:
    - platform: state
      entity_id: cover.roller_door
      to: 'open'
      for:
        minutes: 1
    - platform: state
      entity_id: cover.roller_door
      to: 'open'
      for:
        minutes: 15
    - platform: state
      entity_id: cover.roller_door
      to: 'open'
      for:
        hours: 1
    - platform: state
      entity_id: cover.roller_door
      to: 'open'
      for:
        hours: 2
    - platform: state
      entity_id: cover.roller_door
      to: 'open'
      for:
        hours: 3
    - platform: state
      entity_id: cover.roller_door
      to: 'open'
      for:
        hours: 4
    - platform: state
      entity_id: cover.roller_door
      to: 'open'
      for:
        hours: 5
    - platform: state
      entity_id: cover.roller_door
      to: 'open'
      for:
        hours: 6
  action:
    service: notify.ios_danielsiphone6splus
    data:
      message: "Roller Door Left Open!"
      data:
        push:
          badge: 1
          category: "roller_door_alert"

- alias: Prompt to open roller door when I arrive home
  trigger:
    platform: state
    entity_id: sensor.location_daniel
    to: 'Home'
  condition:
    condition: state
    entity_id: cover.roller_door
    state: 'closed'
  action:
    service: notify.ios_danielsiphone6splus
    data:
      message: "Open the Roller Door?"
      data:
        push:
          category: "roller_door_prompt"


#######################################################################################################
###---------------------------------------- WASHING MACHINE ----------------------------------------###
#######################################################################################################

- alias: Set washing machine active when power detected
  trigger:
    - platform: numeric_state
      entity_id: sensor.washing_machine_power
      above: 20
  condition:
    condition: or
    conditions:
      - condition: state
        entity_id: sensor.washing_machine_status
        state: Idle
      - condition: state
        entity_id: sensor.washing_machine_status
        state: Clean
      - condition: state
        entity_id: sensor.washing_machine_status
        state: Finishing
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.washing_machine_status
        option: Running


- alias: Set washing machine finished when power drops
  trigger:
    - platform: numeric_state
      entity_id: sensor.washing_machine_power
      below: 1
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: sensor.washing_machine_status
        state: Running
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.washing_machine_status
        option: Finishing


- alias: Set washing machine clean after timeout
  trigger:
    - platform: state
      entity_id: sensor.washing_machine_status
      to: Finishing
      for:
        minutes: 2
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: sensor.washing_machine_status
        state: Finishing
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.washing_machine_status
        option: Clean

- alias: Set washing machine dirty when door opens and turn it off
  trigger:
    - platform: state
      entity_id: binary_sensor.door_window_sensor_158d0001aac0f9
      to: 'on'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: sensor.washing_machine_status
        state: Clean
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.washing_machine_status
        option: Idle 
    - service: homeassistant.turn_off
      data:
        entity_id: switch.plug_158d0001db1baf


- alias: Turn washing machine on when door opens
  trigger:
    - platform: state
      entity_id: binary_sensor.door_window_sensor_158d0001aac0f9
      to: 'on'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: sensor.washing_machine_status
        state: Idle
      - condition: state
        entity_id: switch.plug_158d0001db1baf
        state: 'off'
  action:
    - service: homeassistant.turn_on
      data:
        entity_id: switch.plug_158d0001db1baf

- alias: Washing Machine Notification
  trigger:
    platform: state
    entity_id: sensor.washing_machine_status
    to: Clean
  action:
  - service: notify.ios_danielsiphone6splus
    data:
      message: "Washing Machine Finished!"
      data:
        push:
          badge: 7
          category: "washing_machine_alert"

#######################################################################################################
###------------------------------------------- DISHWASHER ------------------------------------------###
#######################################################################################################

- alias: Set dishwasher active when power detected
  trigger:
    - platform: numeric_state
      entity_id: sensor.dishwasher_power
      above: 5
  condition:
    condition: or
    conditions:
      - condition: state
        entity_id: sensor.dishwasher_status
        state: Idle
      - condition: state
        entity_id: sensor.dishwasher_status
        state: Clean
      - condition: state
        entity_id: sensor.dishwasher_status
        state: Finishing
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.dishwasher_status
        option: Running

- alias: Set dishwasher finished when power drops
  trigger:
    - platform: numeric_state
      entity_id: sensor.dishwasher_power
      below: 5
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: sensor.dishwasher_status
        state: Running
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.dishwasher_status
        option: Finishing

- alias: Set dishwasher clean after timeout
  trigger:
    - platform: state
      entity_id: sensor.dishwasher_status
      to: Finishing
      for:
        minutes: 2
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: sensor.dishwasher_status
        state: Finishing
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.dishwasher_status
        option: Clean

- alias: Set dishwasher dirty when door opens and turn it off
  trigger:
    - platform: state
      entity_id: binary_sensor.door_window_sensor_xxx
      to: 'on'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: sensor.dishwasher_status
        state: Clean
  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.dishwasher_status
        option: Idle 
    - service: homeassistant.turn_off
      data:
        entity_id: switch.plug_158d0001dc90d1


- alias: Turn dishwasher on when door opens
  trigger:
    - platform: state
      entity_id: binary_sensor.door_window_sensor_xxx
      to: 'on'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: sensor.dishwasher_status
        state: Idle
      - condition: state
        entity_id: switch.plug_158d0001dc90d1
        state: 'off'
  action:
    - service: homeassistant.turn_on
      data:
        entity_id: switch.plug_158d0001dc90d1

- alias: Dishwasher Notification
  trigger:
    platform: state
    entity_id: sensor.dishwasher_status
    to: Clean
  action:
  - service: notify.ios_danielsiphone6splus
    data:
      message: "Dishwasher Finished!"
      data:
        push:
          badge: 7
          category: "dishwasher_alert"

#######################################################################################################
###---------------------------------------- PANEL AUTOMATIONS --------------------------------------###
#######################################################################################################
##### LIGHTS
- alias: Tablet Lights Detail Panel On
  trigger:
    platform: state
    entity_id: input_select.tablet_panel_detail
    to: "Lights"
  action:
  - service: group.set_visibility
    entity_id: group.tile_tablet_panel_lights
    data:
      visible: True
  - service: homeassistant.turn_on
    entity_id: input_boolean.tile_tablet_button_lights

- alias: Tablet Lights Detail Panel Off
  trigger:
    platform: state
    entity_id: input_select.tablet_panel_detail
    from: "Lights"
  action:
  - service: group.set_visibility
    entity_id: group.tile_tablet_panel_lights
    data:
      visible: False
  - service: homeassistant.turn_off
    entity_id: input_boolean.tile_tablet_button_lights

##### LIGHTS ADVANCED
- alias: Tablet Lights Advanced Detail Panel On
  trigger:
    platform: state
    entity_id: input_select.tablet_panel_detail
    to: "Lights Advanced"
  action:
  - service: group.set_visibility
    entity_id: group.tile_tablet_panel_lights_advanced
    data:
      visible: True
  - service: homeassistant.turn_on
    entity_id: input_boolean.tile_tablet_button_lights_advanced

- alias: Tablet Lights Advanced Detail Panel Off
  trigger:
    platform: state
    entity_id: input_select.tablet_panel_detail
    from: "Lights Advanced"
  action:
  - service: group.set_visibility
    entity_id: group.tile_tablet_panel_lights_advanced
    data:
      visible: False
  - service: homeassistant.turn_off
    entity_id: input_boolean.tile_tablet_button_lights_advanced

- alias: Tablet Lights Advanced Panel Timeout
  trigger:
  - platform: state
    entity_id: input_select.tablet_panel_detail
    to: "Lights Advanced"
    for:
      seconds: 45
  action:
  - service: input_select.select_option
    entity_id: input_select.tablet_panel_detail
    data:
      option: "Lights"
  - service: homeassistant.turn_off
    entity_id: input_boolean.tile_tablet_button_lights_advanced


##### MEDIA
- alias: Tablet Media Detail Panel On
  trigger:
    platform: state
    entity_id: input_select.tablet_panel_detail
    to: "Media"
  action:
  - service: group.set_visibility
    entity_id: group.tile_tablet_panel_media
    data:
      visible: True
  - service: homeassistant.turn_on
    entity_id: input_boolean.tile_tablet_button_media

- alias: Tablet Media Detail Panel Off
  trigger:
    platform: state
    entity_id: input_select.tablet_panel_detail
    from: "Media"
  action:
  - service: group.set_visibility
    entity_id: group.tile_tablet_panel_media
    data:
      visible: False
  - service: homeassistant.turn_off
    entity_id: input_boolean.tile_tablet_button_media

##### CAMERA
- alias: Tablet Camera Detail Panel On
  trigger:
    platform: state
    entity_id: input_select.tablet_panel_detail
    to: "Cameras"
  action:
  - service: group.set_visibility
    entity_id: group.tile_tablet_panel_cameras
    data:
      visible: True
  - service: homeassistant.turn_on
    entity_id: input_boolean.tile_tablet_button_cameras

- alias: Tablet Camera Detail Panel Off
  trigger:
    platform: state
    entity_id: input_select.tablet_panel_detail
    from: "Cameras"
  action:
  - service: group.set_visibility
    entity_id: group.tile_tablet_panel_cameras
    data:
      visible: False
  - service: homeassistant.turn_off
    entity_id: input_boolean.tile_tablet_button_cameras

##### SPRINKLERS
- alias: Tablet Sprinklers Panel On
  trigger:
    platform: state
    entity_id: input_select.tablet_panel_detail
    to: "Sprinklers"
  action:
  - service: group.set_visibility
    entity_id: group.tile_tablet_panel_sprinklers
    data:
      visible: True
  - service: homeassistant.turn_on
    entity_id: input_boolean.tile_tablet_button_sprinklers

- alias: Tablet Sprinklers Panel Off
  trigger:
    platform: state
    entity_id: input_select.tablet_panel_detail
    from: "Sprinklers"
  action:
  - service: group.set_visibility
    entity_id: group.tile_tablet_panel_sprinklers
    data:
      visible: False
  - service: homeassistant.turn_off
    entity_id: input_boolean.tile_tablet_button_sprinklers

##### SPRINKLERS ADVANED
- alias: Tablet Sprinklers Advanced Panel On
  trigger:
    platform: state
    entity_id: input_select.tablet_panel_detail
    to: "Sprinklers Advanced"
  action:
  - service: group.set_visibility
    entity_id: group.tile_tablet_panel_sprinklers_advanced
    data:
      visible: True
  - service: homeassistant.turn_on
    entity_id: input_boolean.tile_tablet_button_sprinklers_advanced

- alias: Tablet Sprinklers Advanced Panel Off
  trigger:
  - platform: state
    entity_id: input_select.tablet_panel_detail
    from: "Sprinklers Advanced"
  action:
  - service: group.set_visibility
    entity_id: group.tile_tablet_panel_sprinklers_advanced
    data:
      visible: False
  - service: homeassistant.turn_off
    entity_id: input_boolean.tile_tablet_button_sprinklers_advanced

- alias: Tablet Sprinklers Advanced Panel Timeout
  trigger:
  - platform: state
    entity_id: input_select.tablet_panel_detail
    to: "Sprinklers Advanced"
    for:
      seconds: 45
  action:
  - service: input_select.select_option
    entity_id: input_select.tablet_panel_detail
    data:
      option: "Sprinklers"

##### WASHER
- alias: Tablet Washer Panel On
  trigger:
    platform: state
    entity_id: input_select.tablet_panel_detail
    to: "Washer"
  action:
  - service: group.set_visibility
    entity_id: group.tile_tablet_panel_washer
    data:
      visible: True
  - service: homeassistant.turn_on
    entity_id: input_boolean.tile_tablet_button_washer

- alias: Tablet Washer Panel Off
  trigger:
    platform: state
    entity_id: input_select.tablet_panel_detail
    from: "Washer"
  action:
  - service: group.set_visibility
    entity_id: group.tile_tablet_panel_washer
    data:
      visible: False
  - service: homeassistant.turn_off
    entity_id: input_boolean.tile_tablet_button_washer

##### DISHWASHER
- alias: Tablet Dishwasher Panel On
  trigger:
    platform: state
    entity_id: input_select.tablet_panel_detail
    to: "Dishwasher"
  action:
  - service: group.set_visibility
    entity_id: group.tile_tablet_panel_dishwasher
    data:
      visible: True
  - service: homeassistant.turn_on
    entity_id: input_boolean.tile_tablet_button_dishwasher

- alias: Tablet Dishwasher Panel Off
  trigger:
    platform: state
    entity_id: input_select.tablet_panel_detail
    from: "Dishwasher"
  action:
  - service: group.set_visibility
    entity_id: group.tile_tablet_panel_dishwasher
    data:
      visible: False
  - service: homeassistant.turn_off
    entity_id: input_boolean.tile_tablet_button_dishwasher

##### ALARM CLOCK
- alias: Tablet Alarm Clock Panel On
  trigger:
    platform: state
    entity_id: input_select.tablet_panel_detail
    to: "Alarm Clock"
  action:
  - service: group.set_visibility
    entity_id: group.tile_tablet_panel_alarm_clock
    data:
      visible: True
  - service: homeassistant.turn_on
    entity_id: input_boolean.tile_tablet_button_alarm_clock

- alias: Tablet Alarm Clock Panel Off
  trigger:
    platform: state
    entity_id: input_select.tablet_panel_detail
    from: "Alarm Clock"
  action:
  - service: group.set_visibility
    entity_id: group.tile_tablet_panel_alarm_clock
    data:
      visible: False
  - service: homeassistant.turn_off
    entity_id: input_boolean.tile_tablet_button_alarm_clock

##### VACUUM CLEANER
- alias: Tablet Vacuum Cleaner Panel On
  trigger:
    platform: state
    entity_id: input_select.tablet_panel_detail
    to: "Vacuum Cleaner"
  action:
  - service: group.set_visibility
    entity_id: group.tile_tablet_panel_vacuum_cleaner
    data:
      visible: True
  - service: homeassistant.turn_on
    entity_id: input_boolean.tile_tablet_button_vacuum_cleaner

- alias: Tablet Vacuum Cleaner Panel Off
  trigger:
    platform: state
    entity_id: input_select.tablet_panel_detail
    from: "Vacuum Cleaner"
  action:
  - service: group.set_visibility
    entity_id: group.tile_tablet_panel_vacuum_cleaner
    data:
      visible: False
  - service: homeassistant.turn_off
    entity_id: input_boolean.tile_tablet_button_vacuum_cleaner

##### SHED
- alias: Tablet Shed Panel On
  trigger:
    platform: state
    entity_id: input_select.tablet_panel_detail
    to: "Shed"
  action:
  - service: group.set_visibility
    entity_id: group.tile_tablet_panel_shed
    data:
      visible: True
  - service: homeassistant.turn_on
    entity_id: input_boolean.tile_tablet_button_shed

- alias: Tablet Shed Panel Off
  trigger:
    platform: state
    entity_id: input_select.tablet_panel_detail
    from: "Shed"
  action:
  - service: group.set_visibility
    entity_id: group.tile_tablet_panel_shed
    data:
      visible: False
  - service: homeassistant.turn_off
    entity_id: input_boolean.tile_tablet_button_shed

##### WEATHER
- alias: Tablet Weather Panel On
  trigger:
    platform: state
    entity_id: input_select.tablet_panel_detail
    to: "Weather"
  action:
  - service: group.set_visibility
    entity_id: group.tile_tablet_panel_weather
    data:
      visible: True
  - service: homeassistant.turn_on
    entity_id: input_boolean.tile_tablet_button_weather

- alias: Tablet Weather Panel Off
  trigger:
    platform: state
    entity_id: input_select.tablet_panel_detail
    from: "Weather"
  action:
  - service: group.set_visibility
    entity_id: group.tile_tablet_panel_weather
    data:
      visible: False
  - service: homeassistant.turn_off
    entity_id: input_boolean.tile_tablet_button_weather

##### MOTION
- alias: Tablet Motion Panel On
  trigger:
    platform: state
    entity_id: input_select.tablet_panel_detail
    to: "Motion"
  action:
  - service: group.set_visibility
    entity_id: group.tile_tablet_panel_motion
    data:
      visible: True
  - service: homeassistant.turn_on
    entity_id: input_boolean.tile_tablet_button_motion

- alias: Tablet Motion Panel Off
  trigger:
    platform: state
    entity_id: input_select.tablet_panel_detail
    from: "Motion"
  action:
  - service: group.set_visibility
    entity_id: group.tile_tablet_panel_motion
    data:
      visible: False
  - service: homeassistant.turn_off
    entity_id: input_boolean.tile_tablet_button_motion

